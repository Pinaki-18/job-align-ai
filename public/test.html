<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Debug Mode</title>
</head>
<body>
    <h1>JobAlign Debugger</h1>
    
    <h3>Test 1: Check Server Health</h3>
    <button onclick="pingServer()">Ping Server</button>

    <h3>Test 2: Upload Resume</h3>
    <input type="file" id="resumeInput" accept=".pdf" />
    <button onclick="uploadResume()">Upload & Extract</button>

    <h3>Results:</h3>
    <p id="status">Waiting...</p>
    <textarea id="output" style="width: 100%; height: 300px;"></textarea>

    <script>
        // TEST 1: Simple Hello World
        async function pingServer() {
            document.getElementById('status').innerText = "Pinging...";
            try {
                // We try to fetch a page that definitely exists
                const response = await fetch('http://localhost:5000/test.html');
                if (response.ok) {
                    alert("‚úÖ SUCCESS: Server is Online and reachable!");
                    document.getElementById('status').innerText = "Server Online";
                } else {
                    alert("‚ùå ERROR: Server connected but returned error: " + response.status);
                }
            } catch (error) {
                alert("üíÄ CRITICAL: Cannot connect to server at all.\nIs it running?\nError: " + error.message);
                document.getElementById('status').innerText = "Connection Failed";
            }
        }

        // TEST 2: The Real Upload
        async function uploadResume() {
            const file = document.getElementById('resumeInput').files[0];
            if (!file) { alert("Please select a file first."); return; }

            document.getElementById('status').innerText = "Uploading...";
            
            const formData = new FormData();
            formData.append('resume', file);

            try {
                const res = await fetch('http://localhost:5000/extract-text', { 
                    method: 'POST', 
                    body: formData 
                });

                if (!res.ok) {
                    const errText = await res.text();
                    throw new Error(`Server Error (${res.status}): ${errText}`);
                }

                const data = await res.json();
                document.getElementById('output').value = data.text;
                document.getElementById('status').innerText = "Extraction Complete!";
                alert("‚úÖ SUCCESS: Text Extracted!");

            } catch (error) {
                console.error(error);
                alert("‚ùå FAILED: " + error.message);
                document.getElementById('status').innerText = "Error Occurred";
                document.getElementById('output').value = error.message;
            }
        }
    </script>
</body>
</html>